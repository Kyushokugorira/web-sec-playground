
## ⚠️ 注意事項

このプロジェクトは**Webアプリのセキュリティ学習・検証用のサンプル**です。
安全な開発・運用のための実験や検証を目的としています。

- 公開サーバーやインターネット上でのホストは推奨しません。
- ローカル環境（localhost）でのみ実行してください。
- 本番用途や重要なデータの取り扱いには使用しないでください。

※ 本リポジトリは参考教材や学習用サンプルを元に独自にカスタマイズしたものです。

## セットアップ手順

### 1. リポジトリのクローン

```
git clone https://github.com/Kyushokugorira/web-sec-playground.git
cd web-sec-playground
```

※ クローン先のディレクトリ名は任意で変更できます。

### 2. 依存関係のインストール

```bash
npm i
```

### 3. 環境変数の設定ファイル (.env) の作成

プロジェクトのルートフォルダに `.env` (環境変数の設定ファイル) を新規作成して以下の内容を記述してください。

```
DATABASE_URL="file:./app.db"
JWT_SECRET=ABCDEFG123456789UVWXYZ
```

- `JWT_SECRET` は認証処理に必要な秘密キーです。安全性を確保するため、適当なランダムな英数字を用いた **16文字以上の文字列** に置き換えてください。文字数が不十分だと、動作時にエラーとなる可能性があります。


### 4. データベースの初期化

```bash
npx prisma db push
npx prisma generate
npx prisma db seed
```


### 5. 開発サーバの起動

```bash
npm run dev
```

### 6. ビルドと実行

```bash
npm run build
npm run start
```

### 7. データベースの状態確認

```bash
npx prisma studio
```

---

## 利用方法・主な機能


- トップページ（`/`）から各機能ページへアクセスできます。
	- ログイン、サインアップ、公開プロフィール編集、OTPデモ、**パスワードリセット**
- **パスワードリセット**（`/reset-password`）
	- メールアドレスを入力しOTPを発行、画面上に表示されたOTPと新しいパスワードを入力することでパスワードを再設定できます。
	- メール送信は行わず、OTPは画面上にのみ表示されます。
- **OTPデモ**（`/otp-demo`）
	- 画面上でOTP（ワンタイムパスワード）の発行・検証を体験できます。
	- メール送信は行わず、発行されたOTPが画面に表示されます。


## 主な変更点・セキュリティ強化

- **OTPデモ機能の追加**
	- `/otp-demo` でOTP発行・検証の流れを画面上で確認できます。
- **パスワードリセット機能の追加**
	- `/reset-password` でOTPによるパスワード再設定が可能になりました。
- **CSP（Content-Security-Policy）等のセキュリティヘッダーをmiddlewareで一括付与**
	- XSS対策としてCSPを厳格化
- **サニタイズ用ユーティリティの追加**
	- `src/app/_utils/sanitize.ts` でDOMPurifyによるサニタイズ関数を提供
- **JWTはJSONレスポンスで返却し、localStorage等で管理する方式**
	- Cookieはサーバーから発行せず、XSS対策を重視した設計
- **パスワード強度判定UIの改善**
	- 入力に応じてリアルタイムで強度表示


## 注意事項

- 本アプリはセキュリティ学習用のため、意図的にデモ的な仕様が含まれています。
- 公開環境や本番用途では絶対に使用しないでください。

---

## 補足

- **パスワードリセットやOTPの仕組みは学習用のため、実際の運用ではメール送信やより厳格なセキュリティ対策が必要です。**
- **ユーザー登録やパスワードリセットの際、画面上にOTPやパスワードが表示される仕様は本番環境では絶対に避けてください。**

---

